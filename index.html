<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flappy Cockatiel</title>
<style>
  body {
    margin: 0;
    background: #70c5ce;
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #70c5ce;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="320" height="480"></canvas>
<script>
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");

let W = canvas.width;
let H = canvas.height;

// Physics
let gravity = 0.25;
let jump = -4.6;
let pipeWidth = 52;
let pipeGap = 100;
let speed = 2;

// Game state
let spawnTimer = 0; // time until next pipe
let spawnInterval = 100; // frames at 60fps (~1.6 sec)
let plane = { x: 50, y: 150, vy: 0, size: 24 };
let pipes = [];
let score = 0;
let gameOver = false;

// Images
let birdImg = new Image();
birdImg.src = "cockatiel.png"; // your bird image

let branchImg = new Image();
branchImg.src = "branch.png"; // your branch image

function reset() {
  plane.y = 150;
  plane.vy = 0;
  pipes = [];
  score = 0;
  spawnTimer = 0;
  gameOver = false;
}

function update(deltaTime) {
  if (!gameOver) {
    // Bird physics
    plane.vy += gravity * deltaTime;
    plane.y += plane.vy * deltaTime;

    // Spawn pipes
    spawnTimer -= deltaTime;
    if (spawnTimer <= 0) {
      let topHeight = Math.random() * (H - pipeGap - 40) + 20;
      pipes.push({ x: W, top: topHeight, bottom: topHeight + pipeGap });
      spawnTimer = spawnInterval; // reset timer
    }

    // Move pipes
    for (let i = pipes.length - 1; i >= 0; i--) {
      pipes[i].x -= speed * deltaTime;

      if (pipes[i].x + pipeWidth < 0) {
        pipes.splice(i, 1);
        score++;
      }
    }

    // Collisions
    for (let p of pipes) {
      if (
        plane.x < p.x + pipeWidth &&
        plane.x + plane.size > p.x &&
        (plane.y < p.top || plane.y + plane.size > p.bottom)
      ) {
        gameOver = true;
      }
    }

    // Ground / ceiling
    if (plane.y + plane.size > H || plane.y < 0) {
      gameOver = true;
    }
  }
}

function draw() {
  ctx.fillStyle = "#70c5ce";
  ctx.fillRect(0, 0, W, H);

  // Clouds
  drawCloud((Date.now() / 50) % (W + 60) - 60, 80, 1.0, 1);
  drawCloud(W - ((Date.now() / 70) % (W + 60)), 140, 0.8, 0.7);

  // Pipes
  ctx.fillStyle = "#228B22";
  for (let p of pipes) {
    ctx.fillRect(p.x, 0, pipeWidth, p.top);
    ctx.fillRect(p.x, p.bottom, pipeWidth, H - p.bottom);
  }

  // Bird
  ctx.drawImage(birdImg, plane.x, plane.y, plane.size, plane.size);

  // Score
  ctx.fillStyle = "#fff";
  ctx.font = "20px Arial";
  ctx.fillText(score, 10, 25);

  // Branch with dev name
  let branchWidth = 100;
  let branchHeight = 30;
  let branchX = W - branchWidth - 5;
  let branchY = 5;
  ctx.drawImage(branchImg, branchX, branchY, branchWidth, branchHeight);
  ctx.fillStyle = "#3e2723";
  ctx.font = "10px Arial";
  ctx.fillText("Dev - Balaji Gopinath", branchX + 5, branchY + 18);

  if (gameOver) {
    ctx.fillStyle = "#fff";
    ctx.font = "20px Arial";
    ctx.fillText("Game Over", W / 2 - 50, H / 2);
  }
}

function drawCloud(x, y, scale, opacity) {
  ctx.globalAlpha = opacity;
  ctx.fillStyle = "#fff";
  ctx.beginPath();
  ctx.arc(x, y, 20 * scale, 0, Math.PI * 2);
  ctx.arc(x + 25 * scale, y - 10 * scale, 15 * scale, 0, Math.PI * 2);
  ctx.arc(x + 50 * scale, y, 20 * scale, 0, Math.PI * 2);
  ctx.fill();
  ctx.globalAlpha = 1;
}

// Controls
canvas.addEventListener("mousedown", function () {
  if (!gameOver) {
    plane.vy = jump;
  } else {
    reset();
  }
});

// Game loop with refresh-rate independence
let lastTime = performance.now();
function loop(timestamp) {
  let deltaTime = (timestamp - lastTime) / (1000 / 60); // scale to 60fps units
  lastTime = timestamp;

  update(deltaTime);
  draw();

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
