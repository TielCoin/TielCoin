<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flappy Cockatiel</title>
<style>
  body {
    margin: 0;
    background: #70c5ce;
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #70c5ce;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="320" height="480"></canvas>
<script>
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");

let W = canvas.width;
let H = canvas.height;

let gravity = 0.25;
let jump = -4.6;
let pipeWidth = 52;
let pipeGap = 100;
let speed = 2;
let frameCount = 0;

let plane = {
  x: 50,
  y: 150,
  vy: 0,
  size: 24
};

let pipes = [];
let score = 0;
let gameOver = false;

// Load bird image
let birdImg = new Image();
birdImg.src = "cockatiel.png"; // replace with your right-facing bird image path

// Load wooden branch image for dev name
let branchImg = new Image();
branchImg.src = "branch.png"; // replace with your carved branch image path

function reset() {
  plane.y = 150;
  plane.vy = 0;
  pipes = [];
  score = 0;
  frameCount = 0;
  gameOver = false;
}

function update(deltaTime) {
  if (!gameOver) {
    plane.vy += gravity * deltaTime;
    plane.y += plane.vy * deltaTime;

    // Add pipes
    if (frameCount % 100 < 1) {
      let topHeight = Math.random() * (H - pipeGap - 40) + 20;
      pipes.push({
        x: W,
        top: topHeight,
        bottom: topHeight + pipeGap
      });
    }

    // Move pipes
    for (let i = pipes.length - 1; i >= 0; i--) {
      pipes[i].x -= speed * deltaTime;

      // Remove off-screen pipes
      if (pipes[i].x + pipeWidth < 0) {
        pipes.splice(i, 1);
        score++;
      }
    }

    // Collision
    for (let p of pipes) {
      if (
        plane.x < p.x + pipeWidth &&
        plane.x + plane.size > p.x &&
        (plane.y < p.top || plane.y + plane.size > p.bottom)
      ) {
        gameOver = true;
      }
    }

    // Hit the ground or top
    if (plane.y + plane.size > H || plane.y < 0) {
      gameOver = true;
    }
  }
}

function draw() {
  ctx.fillStyle = "#70c5ce";
  ctx.fillRect(0, 0, W, H);

  // Draw clouds
  drawCloud(W * 0.15 + (frameCount * 0.2) % W, 80, 1.0, 1);
  drawCloud(W * 0.6 - (frameCount * 0.28) % W, 140, 0.8, 0.7);

  // Draw pipes
  ctx.fillStyle = "#228B22";
  for (let p of pipes) {
    ctx.fillRect(p.x, 0, pipeWidth, p.top);
    ctx.fillRect(p.x, p.bottom, pipeWidth, H - p.bottom);
  }

  // Draw bird
  ctx.drawImage(birdImg, plane.x, plane.y, plane.size, plane.size);

  // Score
  ctx.fillStyle = "#fff";
  ctx.font = "20px Arial";
  ctx.fillText(score, 10, 25);

  // Draw branch with dev name at top right
  let branchWidth = 100;
  let branchHeight = 30;
  let branchX = W - branchWidth - 5;
  let branchY = 5;
  ctx.drawImage(branchImg, branchX, branchY, branchWidth, branchHeight);
  ctx.fillStyle = "#3e2723";
  ctx.font = "10px Arial";
  ctx.fillText("Dev - Balaji Gopinath", branchX + 5, branchY + 18);

  if (gameOver) {
    ctx.fillStyle = "#fff";
    ctx.font = "20px Arial";
    ctx.fillText("Game Over", W / 2 - 50, H / 2);
  }
}

function drawCloud(x, y, scale, opacity) {
  ctx.globalAlpha = opacity;
  ctx.fillStyle = "#fff";
  ctx.beginPath();
  ctx.arc(x, y, 20 * scale, 0, Math.PI * 2);
  ctx.arc(x + 25 * scale, y - 10 * scale, 15 * scale, 0, Math.PI * 2);
  ctx.arc(x + 50 * scale, y, 20 * scale, 0, Math.PI * 2);
  ctx.fill();
  ctx.globalAlpha = 1;
}

canvas.addEventListener("mousedown", function () {
  if (!gameOver) {
    plane.vy = jump;
  } else {
    reset();
  }
});

// === REFRESH RATE FIX ===
let lastTime = performance.now();
function loop(timestamp) {
  let deltaTime = (timestamp - lastTime) / 16.67; // normalize to 60fps
  lastTime = timestamp;

  update(deltaTime);
  draw();

  frameCount += deltaTime;
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
